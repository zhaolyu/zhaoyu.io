---
globs: **/*.test.ts,**/*.test.js,**/*.spec.ts
---

# Testing Standards

When writing tests, always reference [.cursor/docs/TESTING.md](mdc:.cursor/docs/TESTING.md) for comprehensive testing guidelines and complete examples.

## Test File Conventions

- **Naming**: Use `*.test.ts`, `*.test.js`, or `*.spec.ts` extension (SvelteKit projects use `.ts`, not `.tsx`)
- **Location**: Co-locate tests with source files (e.g., `Component.test.ts` next to `Component.svelte`)
- **Structure**: Organize with `describe` blocks for related tests

## Testing Framework

- **Vitest**: Test runner (configured in `package.json` or `vitest.config.ts`)
- **@testing-library/svelte**: For Svelte component testing

## Testing Patterns

### Svelte Components

Use Svelte Testing Library with `render()` and `screen` queries:

```typescript
import { render, screen } from '@testing-library/svelte';
render(Component, { props: { title: 'Test' } });
expect(screen.getByText('Test')).toBeInTheDocument();
```

### Utilities

Test pure functions with various inputs and edge cases. Focus on behavior, not implementation.

### Stores

Test stores by subscribing and checking values using `get()` from `svelte/store`:

```typescript
import { get } from 'svelte/store';
count.update((n) => n + 1);
expect(get(count)).toBe(1);
```

## Mocking Strategies

- **Module mocking**: Use `vi.mock()` for entire modules
- **API mocking**: Use MSW (Mock Service Worker) for HTTP requests
- **localStorage/Window**: Mock with custom implementation in `beforeEach`

## Best Practices

1. **Test organization**: Group related tests with `describe` blocks
2. **Use semantic queries**: Prefer `getByRole`, `getByLabelText` over `getByTestId`
3. **Async testing**: Use `waitFor` for async operations
4. **Cleanup**: Always clean up mocks in `afterEach`
5. **Test behavior, not implementation**: Focus on what the code does, not how

## Running Tests

```bash
npm test                    # Run all tests
npm run test:watch          # Watch mode
npm test -- --coverage      # With coverage
npm test -- path/to/file.test.ts  # Specific file
```

See [.cursor/docs/TESTING.md](mdc:.cursor/docs/TESTING.md) for complete testing documentation and examples.
