---
globs: **/*.ts,**/*.js,**/*.svelte
---

# Code Generation Workflow

**MANDATORY FINAL STEPS**: Complete these steps before marking any code task as done:

1. ✅ Review design principles
2. ✅ Write tests (if applicable)
3. ✅ Run tests and verify they pass
4. ✅ Run lint and fix all issues
5. ✅ Verify everything passes

## Step 0: Review Design Principles

**CRITICAL**: Review code against design principles before finalizing.

### Core Design Principles

- **Single Responsibility**: Each function/component does ONE thing well
- **DRY**: Check `src/lib/utils/` before writing new utilities - see [utilities.mdc](mdc:.cursor/rules/utilities.mdc)
- **KISS**: Simple solutions over complex ones
- **YAGNI**: Build only what's needed now
- **Separation of Concerns**: Separate data fetching, business logic, and UI
- **Theme Support**: All components MUST support both light and dark modes using CSS variables

## When to Write Tests

Write tests for:
- ✅ New components, utilities, stores
- ❌ Style files (CSS) - lint only
- ❌ Configuration files - lint only

## Final Steps Workflow

### Step 1: Review Design Principles

Review code against the principles above. Refactor if needed.

### Step 2: Write Tests (If Applicable)

1. Create test file co-located with source (e.g., `Component.test.ts`)
2. Follow [testing.mdc](mdc:.cursor/rules/testing.mdc) guidelines
3. Aim for **≥90% coverage** (statements, branches, functions, lines)
4. See [TESTING.md](mdc:.cursor/docs/TESTING.md) for patterns

### Step 3: Run Tests

```bash
npm test                          # Run all tests
npm test -- path/to/file.test.ts  # Specific file
npm test -- --coverage            # With coverage (≥90% required)
```

**Requirements**:
- ✅ All tests pass
- ✅ Coverage ≥90% (if tests written)

### Step 4: Run Lint

```bash
npm run lint      # Check for issues
npm run lint:fix  # Auto-fix issues
```

**Requirements**:
- ✅ Zero errors and warnings
- ✅ All code formatted correctly

### Step 5: Final Verification

Before marking complete, verify:
- ✅ Design principles applied
- ✅ No code duplication (checked utilities first)
- ✅ Theme support implemented (light & dark modes using CSS variables)
- ✅ All tests pass (if applicable)
- ✅ Coverage ≥90% (if tests written)
- ✅ Lint passes with zero errors/warnings

## Quick Reference

```bash
npm test              # Run tests
npm test -- --coverage # Check coverage
npm run lint           # Run lint
npm run lint:fix       # Auto-fix lint issues
```

## Related Rules

- [Testing Standards](.cursor/rules/testing.mdc) - Testing requirements
- [Code Quality](.cursor/rules/code-quality.mdc) - Quality verification
- [Coding Conventions](.cursor/rules/coding-conventions.mdc) - Code style
- [Utilities Check](.cursor/rules/utilities.mdc) - DRY principles
- [Testing Guide](.cursor/docs/TESTING.md) - Testing patterns

---

**Enforcement**: This rule is **always applied**. Design review + tests + lint are **mandatory** before completing any code task.
